<html>
  <head>
    <title>Pendularium</title>
    <script src="/socket.io/socket.io.js"></script>
    <style type="text/css">
      div {
        width  : 100px;
        height : 100px;
        float : left;
        border : 1px solid black;
      }
      
      .on {
        background-color : red;
      }
    </style>
  </head>
  <body>
    <div id="p1"></div>
    <div id="p2"></div>
    <div id="p3"></div>
    <div id="p4"></div>
    <div id="p5"></div>
    <div id="p6"></div>
    <script>
      var socketLocation = window.location.hostname;
      var socketLocation = 'http://' + socketLocation + ":" + 8000;
      
      var socket;
      if (navigator.userAgent.indexOf('Mobi') > -1) {
        // device seems to be a mobile, now we can try to send acceleration data & stuff.
        socket = io.connect(socketLocation + "/mobile");
        
        socket.on('connect', function () {
          
          if (window.DeviceOrientationEvent) {  
            window.addEventListener("deviceorientation", function( event ) {  
              //alpha: rotation around z-axis  
              var rotateDegrees = event.alpha;  
              //gamma: left to right  
              var leftToRight = event.gamma;  
              //beta: front back motion  
              var frontToBack = event.beta;  
                             
              handleOrientationEvent( frontToBack, leftToRight, rotateDegrees );  
            }, false);  
          }
        
          var handleOrientationEvent = function( frontToBack, leftToRight, rotateDegrees ){  
              //do something amazing
              socket.emit("mobile", arguments);
          };  
          
          socket.emit('mobile', 'test');
          document.getElementById('p1').innerHTML = "mobile";
        });
        document.getElementById('p2').innerHTML = "mobile";

      } else {
        
        // device seems to be a computer, here come the rendering code.
        socket = io.connect(socketLocation + "/computer");
        socket.on('handshake', function (data) {
          console.log(data);
          socket.emit('handshake', { index: navigator.userAgent.indexOf('Mobi'),my: navigator.userAgent });
        });
        
        socket.on('pendulum', function (data) {
          console.log(data);
          for(var p in data){
            document.getElementById(p).className = data[p] ? 'on' : 'off';
          }
        });
            
        socket.on('mobile', function(data){
          console.log('+MOBILE');
          console.log(data);
        });
      };
    </script>
  </body>
</html>
